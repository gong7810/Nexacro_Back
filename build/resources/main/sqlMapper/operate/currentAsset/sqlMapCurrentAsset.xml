<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.seoulit.erp.account.operate.currentAsset.dao.CurrentAssetDAO">

	<resultMap id="assetResult" type="kr.co.seoulit.erp.account.operate.currentAsset.entity.CurrentAssetEntity">
		<result property="accountCode" column="ACCOUNT_CODE"/>
		<result property="accountName" column="ACCOUNT_NAME"/>
		<result property="assetCode" column="ASSET_CODE"/>
		<result property="assetName" column="ASSET_NAME"/>
		<result property="progress" column="PROGRESS"/>
		<result property="finalizeStatus" column="FINALIZE_STATUS"/>
	</resultMap>

	<resultMap id="assetAllResult" type="kr.co.seoulit.erp.account.operate.currentAsset.entity.CurrentAssetEntity">
		<result property="accountName" column="ACCOUNT_NAME"/>
		<result property="assetCode" column="ASSET_CODE"/>
		<result property="accountCode" column="ACCOUNT_CODE"/>
		<result property="assetName" column="ASSET_NAME"/>
		<result property="progress" column="PROGRESS"/>
		<result property="finalizeStatus" column="FINALIZE_STATUS"/>
		<result property="acquisitionCost" column="ACQUISITION_COST"/>
		<result property="amortizationWay" column="AMORTIZATION_WAY"/>
		<result property="department" column="DEPARTMENT"/>
		<result property="depreciation" column="DEPRECIATION"/>
		<result property="bookValue" column="BOOK_VALUE"/>
		<result property="usefulLife" column="USEFUL_LIFE"/>
		<result property="amortizationFinalYear" column="AMORTIZATION_FINAL_YEAR"/>
		<result property="acquisitionQuantity" column="ACQUISITION_QUANTITY"/>
		<result property="changeQuantity" column="CHANGE_QUANTITY"/>
		<result property="remainQuantity" column="REMAIN_QUANTITY"/>
		<result property="amortizationRate" column="AMORTIZATION_RATE"/>
		<result property="month" column="MONTH"/>
		<result property="normalAmortization" column="NORMAL_AMORTIZATION"/>
		<result property="accumulatedAmortization" column="ACCUMULATED_AMORTIZATION"/>
		<result property="bookValueEnd" column="BOOK_VALUE_END"/>
	</resultMap>

	<resultMap id="depreciationResult" type="kr.co.seoulit.erp.account.operate.currentAsset.entity.CurrentAssetEntity">
		<result property="accountCode" column="ACCOUNT_CODE"/>
		<result property="accountName" column="ACCOUNT_NAME"/>
		<result property="assetCode" column="ASSET_CODE"/>
		<result property="assetName" column="ASSET_NAME"/>
		<result property="progress" column="PROGRESS"/>
		<result property="acquisitionCost" column="ACQUISITION_COST"/>
		<result property="depreciation" column="DEPRECIATION"/>
		<result property="bookValue" column="BOOK_VALUE"/>
		<result property="normalAmortization" column="NORMAL_AMORTIZATION"/>
		<result property="accumulatedAmortization" column="ACCUMULATED_AMORTIZATION"/>
		<result property="bookValueEnd" column="BOOK_VALUE_END"/>
		<result property="acquisitionQuantity" column="ACQUISITION_QUANTITY"/>
		<result property="changeQuantity" column="CHANGE_QUANTITY"/>
		<result property="remainQuantity" column="REMAIN_QUANTITY"/>
	</resultMap>

	<!-- 고정자산 전체 조회 -->
	<select id="findAssetList" resultMap="assetResult">
	<![CDATA[
		SELECT *
		FROM CURRENT_ASSET
		ORDER BY PROGRESS
	]]>
	</select>

	<!-- 고정자산 상세 조회 -->
	<select id="findAssetDetail" parameterType="String" resultMap="assetAllResult">
      <![CDATA[
		SELECT A.ACCOUNT_NAME AS ACCOUNT_NAME
			 , A.ASSET_CODE AS ASSET_CODE
			 , A.ACCOUNT_CODE AS ACCOUNT_CODE
		     , A.ASSET_NAME AS ASSET_NAME
		     , A.PROGRESS AS PROGRESS
		     , A.FINALIZE_STATUS AS FINALIZE_STATUS
		     , D.ACQUISITION_COST AS ACQUISITION_COST
		     , D.AMORTIZATION_WAY AS AMORTIZATION_WAY
			 , D.DEPARTMENT AS DEPARTMENT
		     , D.DEPRECIATION AS DEPRECIATION
		     , D.BOOK_VALUE AS BOOK_VALUE
			 , D.USEFUL_LIFE AS USEFUL_LIFE
		     , D.AMORTIZATION_FINAL_YEAR AS AMORTIZATION_FINAL_YEAR
			 , D.ACQUISITION_QUANTITY AS ACQUISITION_QUANTITY
			 , D.CHANGE_QUANTITY AS CHANGE_QUANTITY
			 , D.REMAIN_QUANTITY AS REMAIN_QUANTITY
			 , D.AMORTIZATION_RATE AS AMORTIZATION_RATE
			 , D.MONTH AS MONTH
		     , D.NORMAL_AMORTIZATION AS NORMAL_AMORTIZATION
		     , D.ACCUMULATED_AMORTIZATION AS ACCUMULATED_AMORTIZATION
		     , D.BOOK_VALUE_END AS BOOK_VALUE_END
		FROM CURRENT_ASSET A, CURRENT_ASSET_DETAIL D
		WHERE A.ASSET_CODE = #{assetCode}
		  AND A.ASSET_CODE = D.ASSET_CODE
	  ]]>
   </select>

	<!-- 고정자산 추가 -->
	<insert id="insertAsset" parameterType="kr.co.seoulit.erp.account.operate.currentAsset.entity.CurrentAssetEntity" >
    <![CDATA[
		INSERT INTO CURRENT_ASSET(ACCOUNT_CODE, ACCOUNT_NAME, ASSET_CODE, ASSET_NAME, PROGRESS, FINALIZE_STATUS)
		VALUES ( #{accountCode}
			   , #{accountName}
			   , #{assetCode}
			   , #{assetName}
			   , REGEXP_REPLACE(#{progress}, '(.{4})(.{2})(.{2})', '\1-\2-\3')
			   , #{finalizeStatus} )
    ]]>
    </insert>

	<!-- 고정자산 수정 -->
	<update id="updateAsset" parameterType="kr.co.seoulit.erp.account.operate.currentAsset.entity.CurrentAssetEntity" >
    <![CDATA[
			UPDATE CURRENT_ASSET
			SET ASSET_NAME = #{assetName}, FINALIZE_STATUS = #{finalizeStatus}
			WHERE ASSET_CODE = #{assetCode}
		]]>
    </update>

	<!-- 고정자산 삭제 -->
	<delete id="deleteAsset" parameterType="String">
   <![CDATA[
		DELETE
		FROM CURRENT_ASSET
		WHERE ASSET_CODE = #{assetCode}
		]]>
   </delete>

	<!-- 감가상각비현황 전체조회 -->
	<select id="findDepreciationList" resultMap="depreciationResult">
      <![CDATA[
		SELECT A.ACCOUNT_CODE,
			   A.ACCOUNT_NAME,
			   TO_CHAR(SUM(D.ACQUISITION_COST), 'FM999,999,999,999') AS ACQUISITION_COST,
			   TO_CHAR(SUM(D.DEPRECIATION), 'FM999,999,999,999')  AS DEPRECIATION,
			   TO_CHAR(SUM(D.BOOK_VALUE), 'FM999,999,999,999') AS BOOK_VALUE,
			   TO_CHAR(SUM(D.NORMAL_AMORTIZATION), 'FM999,999,999,999') AS NORMAL_AMORTIZATION,
			   TO_CHAR(SUM(D.ACCUMULATED_AMORTIZATION), 'FM999,999,999,999') AS ACCUMULATED_AMORTIZATION,
			   TO_CHAR(SUM(D.BOOK_VALUE_END), 'FM999,999,999,999') AS BOOK_VALUE_END
		FROM CURRENT_ASSET A,
			 CURRENT_ASSET_DETAIL D
		WHERE A.ASSET_CODE = D.ASSET_CODE
		GROUP BY A.ACCOUNT_CODE, A.ACCOUNT_NAME
		]]>
    </select>

	<!-- 감가상각비현황 선택조회 -->
	<select id="selectDepreciationList" parameterType="String" resultMap="depreciationResult">
    <![CDATA[
		SELECT A.ASSET_CODE,
			   A.ASSET_NAME,
			   TO_CHAR(sum(D.ACQUISITION_COST), 'FM999,999,999,999') AS ACQUISITION_COST,
			   TO_CHAR(sum(D.DEPRECIATION), 'FM999,999,999,999') AS DEPRECIATION,
			   TO_CHAR(sum(D.BOOK_VALUE), 'FM999,999,999,999') AS BOOK_VALUE,
			   TO_CHAR(sum(D.NORMAL_AMORTIZATION), 'FM999,999,999,999') AS NORMAL_AMORTIZATION,
			   TO_CHAR(sum(D.ACCUMULATED_AMORTIZATION), 'FM999,999,999,999') AS ACCUMULATED_AMORTIZATION,
			   TO_CHAR(sum(D.BOOK_VALUE_END), 'FM999,999,999,999') AS BOOK_VALUE_END
		FROM CURRENT_ASSET A,
			 CURRENT_ASSET_DETAIL D
		WHERE A.ACCOUNT_CODE = #{accountCode}
		  AND A.ASSET_CODE = D.ASSET_CODE
		GROUP BY A.ACCOUNT_CODE, A.ACCOUNT_NAME, A.ASSET_CODE, A.ASSET_NAME
		]]>
    </select>

	<!--    고정자산관리대장 전체조회-->
	<select id="fixedAssetLedgerList" resultMap="depreciationResult">
      <![CDATA[
		SELECT  DECODE(GROUPING_ID(A.ACCOUNT_CODE,
								   A.ACCOUNT_NAME,
								   A.ASSET_CODE,
								   A.ASSET_NAME,
								   A.PROGRESS), 7, null, A.ACCOUNT_CODE) AS ACCOUNT_CODE,
				DECODE(GROUPING_ID(A.ACCOUNT_CODE,
								   A.ACCOUNT_NAME,
								   A.ASSET_CODE,
								   A.ASSET_NAME,
								   A.PROGRESS), 7, '[ ' || ACCOUNT_NAME || ' 소계 ]', A.ACCOUNT_NAME) AS ACCOUNT_NAME,
				A.ASSET_CODE,
				A.ASSET_NAME,
				A.PROGRESS,
				TO_CHAR(sum(AD.ACQUISITION_COST), 'FM999,999,999,999') AS ACQUISITION_COST,
				TO_CHAR(sum(AD.DEPRECIATION), 'FM999,999,999,999') AS DEPRECIATION,
				TO_CHAR(sum(AD.BOOK_VALUE), 'FM999,999,999,999') AS BOOK_VALUE,
				TO_CHAR(sum(AD.NORMAL_AMORTIZATION), 'FM999,999,999,999') AS NORMAL_AMORTIZATION,
				TO_CHAR(sum(AD.ACCUMULATED_AMORTIZATION), 'FM999,999,999,999') AS ACCUMULATED_AMORTIZATION,
				TO_CHAR(sum(AD.BOOK_VALUE_END), 'FM999,999,999,999') AS BOOK_VALUE_END
		FROM CURRENT_ASSET A,
			 CURRENT_ASSET_DETAIL AD
		WHERE A.ASSET_CODE = AD.ASSET_CODE
		GROUP BY ROLLUP (A.ACCOUNT_CODE,
						 A.ACCOUNT_NAME,
						 A.ASSET_CODE,
						 A.ASSET_NAME,
						 A.PROGRESS)
		HAVING GROUPING_ID(A.ACCOUNT_CODE,
						   A.ACCOUNT_NAME,
						   A.ASSET_CODE,
						   A.ASSET_NAME,
						   A.PROGRESS) IN (0, 7)

		ORDER BY A.ACCOUNT_CODE, A.PROGRESS
		]]>
    </select>

</mapper>