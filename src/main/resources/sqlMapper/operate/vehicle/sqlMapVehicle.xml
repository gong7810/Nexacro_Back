<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.seoulit.erp.account.operate.vehicle.dao.VehicleDAO">

    <!-- 업무용차량 전체조회 -->
    <select id="findVehicleList" resultType="kr.co.seoulit.erp.account.operate.vehicle.entity.VehicleEntity">
        <![CDATA[
            SELECT
                V.VEHICLE_CODE AS VEHICLE_CODE,
                VEHICLE_NUMBER,
                VEHICLE_TYPE,
                V.DEPT_CODE AS DEPT_CODE,
                V.DEPT_NAME AS DEPT_NAME,
                V.EMP_CODE AS EMP_CODE,
                V.EMP_NAME AS EMP_NAME,
                AVAILABILITY,
                SUM(VL.DISTANCE) AS DISTANCE,
                SUM(VL.BUSINESS_DISTANCE) AS BUSINESS_DISTANCE,
                ROUND((SUM(VL.BUSINESS_DISTANCE)/SUM(VL.DISTANCE))*100, 1) AS BUSINESS_USAGE_RATIO
            FROM VEHICLE V, VEHICLE_LOGBOOK VL
            WHERE V.VEHICLE_CODE = VL.VEHICLE_CODE(+)
            GROUP BY V.VEHICLE_CODE,
                     VEHICLE_NUMBER,
                     VEHICLE_TYPE,
                     V.DEPT_CODE,
                     V.DEPT_NAME,
                     V.EMP_CODE,
                     V.EMP_NAME,
                     AVAILABILITY
            ORDER BY V.VEHICLE_CODE
        ]]>
    </select>

    <!-- 업무용차량 한개조회 -->
    <select id="findVehicle" parameterType="String" resultType="kr.co.seoulit.erp.account.operate.vehicle.entity.VehicleEntity">
        <![CDATA[
            SELECT *
            FROM VEHICLE
            WHERE VEHICLE_CODE = #{vehicleCode}
        ]]>
    </select>

    <!-- 업무용차량 추가 -->
    <insert id="insertVehicle" parameterType="kr.co.seoulit.erp.account.operate.vehicle.entity.VehicleEntity">
        <![CDATA[
        INSERT INTO VEHICLE (
            VEHICLE_CODE,
            VEHICLE_NUMBER,
            VEHICLE_TYPE,
            DEPT_CODE,
            DEPT_NAME,
            EMP_CODE,
            EMP_NAME,
            AVAILABILITY
        )
        VALUES (
            #{vehicleCode},
            #{vehicleNumber},
            #{vehicleType},
            #{deptCode},
            #{deptName},
            #{empCode},
            #{empName},
            #{availability}
        )
        ]]>
    </insert>

    <!-- 업무용차량 수정 -->
    <update id="updateVehicle" parameterType="kr.co.seoulit.erp.account.operate.vehicle.entity.VehicleEntity">
        <![CDATA[
            UPDATE VEHICLE SET
                DEPT_CODE = #{deptCode},
                DEPT_NAME = #{deptName},
                EMP_CODE = #{empCode},
                EMP_NAME = #{empName},
                AVAILABILITY = #{availability}
            WHERE VEHICLE_CODE = #{vehicleCode}
        ]]>
  </update>

    <!-- 업무용차량 삭제 -->
    <delete id="deleteVehicle" parameterType="String">
        <![CDATA[
            DELETE FROM VEHICLE
            WHERE VEHICLE_CODE = #{vehicleCode}
        ]]>
    </delete>

</mapper>